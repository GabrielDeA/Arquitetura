                org 100h

INCLUDE "emu8086.inc"

TAMANHO EQU 32

org 100h

DEFINE_GET_STRING
DEFINE_PRINT_STRING

    MOV DI, OFFSET PALAVRA
    MOV DX, TAMANHO + 1
    CALL GET_STRING
   
    MOV SI, OFFSET PALAVRA
    MOV DI, OFFSET INICIO_A
    MOV BX, OFFSET TRACO                             
                                 
    CALL PULA_LINHA                                  
    CALL PROCURA_ESQUERDA_DIREITA 
    DE:
    MOV SI, OFFSET PALAVRA
    MOV DI, OFFSET INICIO_A
    MOV BX, OFFSET TRACO
    
    CALL PULA_LINHA
    CALL PROCURANDO_DIREITA_ESQUERDA
      

PROCURA_ESQUERDA_DIREITA:
    PUSHF  
    PUSH DX  
    
    
PROCURANDO_ESQUERDA_DIREITA_IGUAIS:
    MOV DL, [SI]
    MOV DH, [DI]
    
    CMP DL, 0
    JE  ACHOU_SUBSTRING_PROCURA_ESQUERDA_DIREITA 
    
    CMP DH, 0                                        
    JE  NAO_ACHOU_SUBSTRING_PROCURA_ESQUERDA_DIREITA 
    
    CMP DH,DL
    JE  IGUAL_PARCIAL_PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
    
    CMP DH, DL
    JNE IMPRIMIR_TRACO_ED
    
IMPRIMIR_TRACO_ED:
    
    MOV AH,2 
    MOV DL, [BX]
    INT 21H
    CMP DL, '@'
    JE PULA_ED 
    INC BX
    MOV DL,[BX]
    CMP DL, 0
    JE FIM_PROCURA_ESQUERDA_DIREITA
    MOV DL, [SI]
                             
    MOV SI, OFFSET PALAVRA
    INC DI
    JMP PROCURANDO_ESQUERDA_DIREITA_IGUAIS
    
IGUAL_PARCIAL_PROCURANDO_ESQUERDA_DIREITA_IGUAIS: 
    MOV AH, 2
    MOV DL, [SI]
    INT 21H
    INC SI
    INC DI 
    INC BX
    INC BP ; BP SERA CONTADOR     
    
    MOV DL, [SI]
    MOV DH, [DI]
    CMP DH, DL
    JNE RETORNA_TRACO_BACKSPACE_PUSH_ED
             
    JMP PROCURANDO_ESQUERDA_DIREITA_IGUAIS   
    
RETORNA_TRACO_BACKSPACE_PUSH_ED:
    PUSH BP
    JMP RETORNA_TRACO_BACKSPACE_ED
    
RETORNA_TRACO_BACKSPACE_ED:
    CMP DL, 0
    JE PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
    CMP BP, 0
    JE PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
    
    MOV AH, 2
    MOV DL, 08
    INT 21H  
    DEC BP    
    CMP BP, 0
    JE RETORNA_TRACO_POP_ED
    JMP RETORNA_TRACO_BACKSPACE_ED 
    
RETORNA_TRACO_POP_ED:
    POP BP
    JMP RETORNA_TRACO_ED
    
RETORNA_TRACO_ED: 
    CMP DL, 0
    JE PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
    CMP BP, 0
    JE PROCURANDO_ESQUERDA_DIREITA_IGUAIS
    
    MOV AH, 2
    MOV DL, '-' 
    INT 21H
    DEC BP
    
    DEC SI 
    
    CMP BP, 0
    JE PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
    
    JMP RETORNA_TRACO_ED
    
ACHOU_SUBSTRING_PROCURA_ESQUERDA_DIREITA: 
    CALL IMPRECAO_ED 
      
IMPRECAO_ED:
    
    MOV AH,2
    MOV DL,[SI]
    INT 21H 
    INC BX 
    INC SI
    CMP DL, 0
    JE RESTO_IMPRECAO_ED
    JMP IMPRECAO_ED
RET
  
    
RESTO_IMPRECAO_ED:
    MOV AH,2
    MOV DL,[BX]
    INT 21H
    CMP DL, '@'
    JE PULA_FIM_ED 
    INC BX
    MOV DL,[BX]
    CMP DL, 0 
    
    JE FIM_PROCURA_ESQUERDA_DIREITA 
    JMP RESTO_IMPRECAO_ED
           
    
NAO_ACHOU_SUBSTRING_PROCURA_ESQUERDA_DIREITA:   
    MOV SI, OFFSET NAO_ACHADO
    CALL PRINT_STRING
    
FIM_PROCURA_ESQUERDA_DIREITA:
    POP DX
    POPF
    JMP DE  

PULA_ED:
CALL PULA_LINHA
INC BX
JMP PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
RET
    
 PULA_FIM_ED:
CALL PULA_LINHA
INC BX
JMP RESTO_IMPRECAO_ED
RET
   
    
    ; DA DIREITA PARA A ESQUERDA
    
PROCURANDO_DIREITA_ESQUERDA:
    PUSHF
    PUSH DX
    
PROCURANDO_DIREITA_ESQUERDA_IR_FINAL_PALAVRA:
    MOV DL, [SI]
    CMP DL, 0
    JE CHEGOU
    INC SI
    INC LENGHT  
    JMP PROCURANDO_DIREITA_ESQUERDA_IR_FINAL_PALAVRA

    
CHEGOU:
    DEC SI
    DEC LENGHT
    PUSH SI
    JMP PROCURANDO_DIREITA_ESQUERDA_IGUAIS
    
PROCURANDO_DIREITA_ESQUERDA_IGUAIS:
    MOV DL, [SI]
    MOV DH, [DI]
    
    CMP BP, LENGHT
    JE  ACHOU_SUBSTRING_PROCURA_DIREITA_ESQUERDA 
    
    CMP DH, 0                                        
    JE  NAO_ACHOU_SUBSTRING_PROCURA_DIREITA_ESQUERDA 
    
    CMP DH,DL
    JE  IGUAL_PARCIAL_PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    
    CMP DH, DL
    JNE IMPRIMIR_TRACO_DE 
    
IMPRIMIR_TRACO_DE:
    
    MOV AH,2 
    MOV DL, [BX]
    INT 21H
    CMP DL, '@'
    JE PULA_DE 
    INC BX
    MOV DL,[BX]
    CMP DL, 0
    JE FIM_PROCURA_DIREITA_ESQUERDA
    MOV DL, [SI]                          
    POP SI
    PUSH SI
    INC DI
    JMP PROCURANDO_DIREITA_ESQUERDA_IGUAIS  
    
IGUAL_PARCIAL_PROCURANDO_DIREITA_ESQUERDA_IGUAIS: 
    MOV AH, 2
    MOV DL, [SI]
    INT 21H
    DEC SI
    INC DI 
    INC BX
    INC BP ; BP SERA CONTADOR
    
    CMP BP, LENGHT
    JE  ACHOU_SUBSTRING_PROCURA_DIREITA_ESQUERDA   
    
    MOV DL, [SI]
    MOV DH, [DI]
    CMP DH, DL
    JNE RETORNA_TRACO_BACKSPACE_PUSH_DE
             
    JMP PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    
RETORNA_TRACO_BACKSPACE_PUSH_DE:
    PUSH BP
    JMP RETORNA_TRACO_BACKSPACE_DE
    
RETORNA_TRACO_BACKSPACE_DE:
    CMP DL, 0
    JE PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    CMP BP, 0
    JE PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    
    MOV AH, 2
    MOV DL, 08
    INT 21H  
    DEC BP    
    CMP BP, 0
    JE RETORNA_TRACO_POP_DE
    JMP RETORNA_TRACO_BACKSPACE_DE  

RETORNA_TRACO_POP_DE:
    POP BP
    JMP RETORNA_TRACO_DE
    
RETORNA_TRACO_DE: 
    CMP DL, 0
    JE PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    CMP BP, 0
    JE PROCURANDO_DIREITA_ESQUERDA_IGUAIS
    
    MOV AH, 2
    MOV DL, '-' 
    INT 21H
    DEC BP
    
    INC SI 
    
    CMP BP, 0
    JE PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
    
    JMP RETORNA_TRACO_DE        

ACHOU_SUBSTRING_PROCURA_DIREITA_ESQUERDA: 
    CALL IMPRECAO_DE 
      
IMPRECAO_DE:
    
    MOV AH,2
    MOV DL,[SI]
    INT 21H 
    INC BX 
    DEC SI
    CMP BP, LENGHT
    JE RESTO_IMPRECAO_DE
    JMP IMPRECAO_DE
RET
  
    
RESTO_IMPRECAO_DE:
    MOV AH,2
    MOV DL,[BX]
    INT 21H
    CMP DL, '@'
    JE PULA_FIM_DE 
    INC BX
    MOV DL,[BX]
    CMP DL, 0 
    
    JE FIM_PROCURA_DIREITA_ESQUERDA 
    JMP RESTO_IMPRECAO_DE

NAO_ACHOU_SUBSTRING_PROCURA_DIREITA_ESQUERDA:   
    MOV SI, OFFSET NAO_ACHADO
    CALL PRINT_STRING
    
FIM_PROCURA_DIREITA_ESQUERDA:
    POP DX
    POPF
    RET 
    
IR_FINAL_PALAVRA_DE:
    MOV DL, [SI]
    CMP DL, 0
    JE CHEGOU_2_DE
    INC SI
    JMP IR_FINAL_PALAVRA_DE
    
CHEGOU_2_DE:
    DEC SI
    PUSH SI
    RET 
    
     
PULA_FIM_DE:
CALL PULA_LINHA
INC BX
JMP RESTO_IMPRECAO_DE
RET  

PULA_DE:
CALL PULA_LINHA
INC BX
JMP PROCURANDO_DIREITA_ESQUERDA_IGUAIS 
RET

 
PULA_LINHA:                      
    pushf
    push ax
    push dx
    MOV AH,2
    MOV DL,13        
    INT 21H
    MOV AH,2
    MOV DL,10
    INT 21H
    pop dx        
    pop ax
    popf
    RET   


    
PULA:
CALL PULA_LINHA
INC BX
JMP PROCURANDO_ESQUERDA_DIREITA_IGUAIS 
RET
  
          

;PROCURA BAIXO CIMA


PALAVRA DB TAMANHO DUP(" "),0 

LENGHT DW 0 

                                                       
;use qualquer marcador                                                          
;fixo 10x40
         DB 0,"#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$@"
INICIO_A DB   "!MSJDFLMIGLOKUELSADKLFJKKLSJDFKLASJDFKJSM@"
         DB   "!AIJDFLKASJDKFLJSADLEUGIMLSJDFKLASJDFKJIA@"
         DB   "!ALGKDFJKLASDJFFMSAJDKLJJSADKLFJLKDSAJGJK@"
         DB   "!ASJUFLKASMIGUELISADLEUGIMPSJDFKLESJMUKJS@"
         DB   "!ALLKELDFASDDJFHGSAJDKUEJSADKLFJLKULEJFLK@"
         DB   "!ASEDELKASJDKFLKUADKLFGLKLSJDFKLASJLEKJSA@"
         DB   "!ALUUDFJKLASDJFEESAJDKILJSADKLFJLKKSUUFLK@"
         DB   "!ASGDFLKASJDKFLLLADKLFMAKLSJDFKLASJDEMGSA@"
         DB   "!AIIKDFJKLASDJFJKSAJDKFLJSALEUGIMKDSLJFIK@"
INICIO_B DB   "!MSFDFLKASJDKFLJSADKLFJAKLSJDFKLASJDFKJSM@"
         DB   "*****************************************#",0
      
      
         DB 0,"#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$@"
TRACO    DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "!----------------------------------------@"
         DB   "*****************************************#",0  
NAO_ACHADO DB "NAO ACHADO",0
RET
